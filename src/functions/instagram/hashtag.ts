import fs from 'fs'

import { log, terminate, initialize, setCookie } from 'helpers'

const sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms))
let hashtags: string[] = [
  'grl購入品',
  'grlコーデ',
  '骨格ストレート',
  '骨格ストレートタイプ',
  '骨格ストレートが似合う王道スタイル',
  '骨格ストレートのカジュアルコーデ',
  '骨格ストレート服',
  '骨スト大勝利',
  'プチプラコーデ',
  'プレゼント選び',
  '彼氏プレゼント',
  '彼氏誕生日',
  '誕生日プレゼント',
  'お祝い',
  'お祝いギフト',
  'ギフト',
  '男性プレゼント',
  '男性ギフト',
  'maisonkitsune',
  'メゾンキツネ',
  'ポロラルフローレン',
  'poloralphlauren',
  'ジョーマローン',
  'ジョーマローンロンドン',
  '大学生カップル',
  '大学生プレゼント',
  'blacklabel',
  'バーバリー',
  '男性ブランド',
  'グレイル購入品',
  'グレイルコーデ',
  'プチプラ高見えコーデ',
  '春コーディネート',
  'ジェラートカラー',
  'パステルカラーコーデ',
  '春服コーデ',
  '春服コーディネート',
  '春夏コーデ',
  'スプリングコーデ',
  'トレンドコーデ',
  'トレンドファッション',
  'ベスコス',
  'ベスコス2020',
  'ベスコス殿堂入り',
  'コスメがわかるハッシュタグ',
  'コスメ好きさんと繋がりたい',
  'コスメ垢さんと繋がりたい',
  'コスメ比較',
  'コスメレポート',
  'コスメマニアと繋がりたい',
  'コスメが好き',
  '化粧好き',
  'メイク好き',
  'メイク好きさんとつながりたい',
  'メイクが好きな人と繋がりたい',
  'メイクオタク',
  'コスメランキング',
  'アイシャドウ',
  'おすすめアイシャドウ',
  'アイシャドウパレット',
  'アイシャドウマニア',
  'アイシャドウ大好き',
  'キャンメイクアイシャドウ',
  'デイジークシャドウパレット',
  'クリオアイシャドウパレット',
  'エチュードハウスアイシャドウ',
  'アイメイク方法',
  '垢抜けたい',
  '垢抜ける方法',
  '垢抜けたい人と繋がりたい',
  '骨格ウェーブ',
  '骨格ウェーブコーデ',
  '骨格ウェーブダイエット',
  '骨格ウェーブタイプ',
  '骨格診断ウェーブ',
  '骨格別コーデ',
  '骨格診断',
  'モテ',
  'モテコーデ',
  'モテる方法',
  'コーデ',
  'snidel',
  'スナイデル',
  'スナイデルコーデ',
  'proportion',
  'frayid',
  'フレイアイディー',
  'olコーデ',
  '20代コーデ',
  '大人かわいいコーデ',
  '春コーデ',
  '春コーテ',
  '春ファッション',
  '春ファッション2021',
  '春ファッションコーデ',
  'お洒落さんになりたい',
  'お洒落さんと繫がりたい',
  '垢抜ける',
  '似合わせコーデ',
  'コーディネート',
  'ブルベ冬',
  'ブルベ',
  'ブルベ冬コスメ',
  'ブルベウインター',
  'ウィンタータイプ',
  'パーソナルカラーウィンター',
  'パーソナルカラー冬',
  '冬タイプ',
  'ブルーベース冬',
  'グレイルワンピース',
  '骨格ウェーブ優勝',
  '骨格ウェーブ体型',
  '骨格ウェーブ大勝利',
  '骨ウェーブ',
  '骨ウェ',
  '骨格',
  '骨格タイプ',
  'ダイエット初心者',
  'ダイエット',
  'ダイエット方法',
  '痩せたい人集合',
  '痩せたい人と繋がりたい',
  '痩せたいけど痩せない',
  '痩せたい痩せたい痩せたい',
  '痩せたいのに',
  '痩せたい人',
  '痩せたいけど痩せれない',
  '痩せたいです',
  '痩せたいひとと繋がりたい',
  '華奢になりたい',
  '痩せる',
  'ダイエット開始',
  'ダイエットメニュー',
  'ダイエット仲間と繋がりたい',
  'ダイエット頑張る',
  'ダイエット法',
  'ダイエット情報',
  '痩せたいが口癖',
  '痩せたい女子',
  '骨格ストレート大勝利',
  '痩せ',
  '痩せる方法',
  '痩せる習慣',
  '痩せたら人生変わる',
  '痩せるぞ',
  '痩せる方法教えて',
  'ダイエット女子',
  'zara',
  'zarawomen',
  'zaraoutfit',
  'zaradaily',
  'zara女子',
  'zara女',
  'ザラ',
  'ザラジョ',
  'ザラ購入品',
  'ザラコーデ',
  'ザラ女',
  '水色コーデ',
  'ブルーコーデ',
  'ブルーコーディネート',
  'お洋服大好き',
  'お洋服が好きな人と繋がりたい',
  '春色カラー',
  '春色コーデ',
  '空色',
  '空色color',
  '可愛くなりたい人と繋がりたい',
  '透明感欲しい',
  '透明感のある写真',
  '水色好き',
  '垢抜けたい女子',
  '洋服が好き',
  '洋服が好きな人と繋がりたい',
  'オシャレ女子コーデ',
  'gu新作コーデ',
  'ジーユー',
  'ジーユー購入品',
  'ジーユーコーデ',
  'ジーユーマニア',
  'ジーユー新作',
  'シーユー',
  'ジーユー女子',
  'ブルベ夏',
  'ブルベコーデ',
  'ブルベウィンター',
  'ブルベサマー',
  'パーソナルカラーサマー',
  'パーソナルカラーウインター',
  'パーソナルカラー診断',
  'パーソナルカラー',
  '春服',
  '春服欲しい',
  '春新作',
  'プレゼントに最適',
  'プレゼントにおすすめ',
  'プレゼントに',
  'プレゼント用',
  'プレゼントにも',
  'プレゼント探し',
  'プレゼントにもオススメ',
  'プレゼントまとめ',
  'ジェラートピケ',
  'gelatopique',
  'ジルスチュアート',
  'jillstuart',
  'francfranc',
  'francfrancのある生活',
  'francfranc購入品',
  'francfranclife',
  'francfranc大好き',
  'francfranc生活',
  'フランフラン',
  '自分へのご褒美',
  '自分への誕生日プレゼント',
  '自分へのプレゼント',
  '自分へのご褒美に',
  '予算1000円',
  '1000円プレゼント',
  '骨格ストレートヘアスタイル',
  '骨格診断ストレート',
  '骨格診断ストレートタイプ',
  '髪型アレンジ',
  '髪型で人生は変わる',
  '髪型ミディアム',
  'モテ髪',
  'モテヘア',
  'モテヘアー',
  'モテヘアスタイル',
  'モテヘアアレンジ',
  'モテる髪型',
  'モテる女子',
  'モテテク',
  'モテテクニック',
  '垢抜けヘア',
  '垢抜け方法',
  '可愛くなる方法',
  '可愛くなりたい',
  '財布',
  'サイフ',
  'バレンシアガ',
  'バレンシアガ財布',
  '小さい財布',
  'ミニ財布',
  '革小物',
  '革財布',
  'ブランド財布',
  'オトナ女子',
  '女子力向上委員会',
  '透明感カラー',
  'mercuryduo',
  'マーキュリーデュオ',
  'ミッシュマッシュ',
  'mischmasch',
  'アニエスベー',
  'アニエスベー財布',
  'agnesb',
  'coach',
  'コーチ',
  'コーチ財布',
  'プチプラファッション',
  '骨格ストレートコーデ',
  'セットアップ',
  'セットアップコーデ',
  'ジャケットコーデ',
  'ジャケット',
  'ジャケット女子',
  'スタイルアップ',
  'majesticlegon',
  'majegirls',
  'majegirl',
  'マジェスティックレゴン',
  'マジェガール',
  'キャンパスコーデ',
  'デートコーデ',
  '春デートコーデ',
  '着痩せコーデ',
  '着痩せテク',
  '着痩せ',
  '着痩せ効果',
  'モテ服',
  '大学生コーデ',
  '垢抜けコーデ',
  'ホワイトデーお返し',
  'ホワイトデー',
  'ホワイトデーギフト',
  'ホワイトデーのお返し',
  '彼女プレゼント',
  'プレゼント探\nし',
  'ギフトセット',
  'ギフトボックス',
  'ギフトラッピング',
  'ギフト選び',
  'ギフト券',
  '骨格ナチュラル',
  '骨格ナチュラルコーデ',
  '骨格ナチュラルタイプ',
  '骨ナチュ',
  'coen',
  'コーエン',
  'ナノユニバース',
  'nanouniverse',
  'ユナイテッドアローズ',
  'ARROWS',
  'アローズ',
  'ropepicnic',
  'ロペピクニック',
  '服好きな人と繋がりたい',
  '服好きさんと繋がりたい',
  'ファッション好き',
  'ダイエット垢さんと繋がりたい',
  '似合わせコーディネート',
  'ナチュラルコーデ',
  '骨格診断ナチュラル',
  'キレイめコーデ',
  'キレイめカジュアル',
  'マジェ',
  'モテコーディネート',
  'モテ服コーデ',
  'デート服コーデ',
  'デート服',
  'gu購入品',
  'gu購入品レポ',
  'guレビュー',
  '青コーデ',
  'パステルブルー',
  'tシャツ',
  'リブニット',
  'カーディガン',
  'かわいくなりたい',
  'guしか勝たん',
  'guコーデ',
  'guコーデ部',
  '春の新作',
  'gu女子',
  'ジーユーおすすめ',
  'イエベ',
  'イエベコーデ',
  'イエベ秋',
  'イエベ春',
  'パーソナルカラースプリング',
  'パーソナルカラーオータム',
  'プチプラ部',
  'プチプラコーディネート',
  'お洒落さんとつながりたい',
  'ファッション好きな人と繋がりたい',
  'ファッションコーディネート',
  'ファッショントレンド',
  '骨格タイプ診断',
  'ストレートタイプ',
  'ダイエットしてる人と繋がりたい',
  '春アウター',
  'テーラードジャケット',
  'チェスターコート',
  'ライダースジャケット',
  'トレンチコート',
  'トレンチコートコーデ',
  '春から大学生',
  '春からjk',
  'francfranc食器',
  '新生活',
  '新生活準備',
  'ひとり暮らし',
  '一人暮らし女子',
  '一人暮らし',
  '一人暮らしインテリア',
  '一人暮らしルーム',
  '女子力アップ',
  '生活雑貨',
  '女子力',
  '女子力あげたい',
  '女子力向上計画',
  '女子力向上',
  'モテ女子',
  'ライブグッズ',
  'ひとり暮らしインテリア',
  '一人暮らし準備',
  '透け感女子',
  '透明感女子',
  '透明感',
  '透明感のある世界',
  '透明感アップ',
  '透明感ほしい',
  '透明感抜群',
  '透け感が可愛い',
  '白くなりたい',
  '儚い',
  'シアー感アイテム',
  'シアートップス',
  'シアーアイテム',
  '透け感トップス',
  '透け感コーデ',
  'パフスリーブ',
  'パフスリーブブラウス',
  '骨格スタイルストレート',
  'おすすめコーデ',
  '骨ストさんと繋がりたい',
  '服好きな人とつながりたい',
  'ダイエット仲間',
  '痩せ見えコーデ',
  '痩せ見え',
  '骨格スタイル分析',
  'rienda',
  'lagunamoon',
  'royalparty',
  '骨格タイプストレート',
  'ワンピース',
  'ワンピース好きな人と繋がりたい',
  'ワンピース好きと繋がりたい',
  'snidelワンピース',
  'jillbyjillstuart',
  'jillbyjillstuart好きな人と繋がりたい',
  '骨格ウェーブのコーディネート',
  '骨格ウェーブ服',
  '似合う服',
  'ウェーブ体型さんにおすすめ'
]

const target = 'sheer.jp'
const holder: {
  hashtag: string
  count: number
  people: string[]
}[] = []
async function main() {
  process.on('exit', () => {
    console.log({ holder })
    fs.writeFileSync('./result.txt', JSON.stringify(holder))
  })
  try {
    const page = await initialize()
    if (!page) return null

    await setCookie(page, 'kentozuka', 's3')

    for (const tag of hashtags) {
      await page.goto(`https://www.instagram.com/explore/tags/${tag}`, {
        waitUntil: 'networkidle2'
      })

      const [topNine, count] = await page.evaluate(() => {
        // @ts-ignore
        const data = window._sharedData.entry_data.TagPage[0].data
        const mediaCount = data.media_count
        const tops = data.top.sections
          .map((x: any) => x.layout_content.medias)
          .flat()
        const media = tops.map((x: any) => x.media)
        return [media.map((x: any) => x.user.username), mediaCount]
      })
      const result = {
        hashtag: tag,
        count: topNine.filter((x: any) => x == target).length,
        people: topNine,
        media: count
      }
      if (result.count > 0) {
        holder.push(result)
        log(`Found: ${result.hashtag}`)
      } else {
        log(`${target} not found: ${result.hashtag}`)
      }
      await sleep(5000)
    }

    // page.on('response', async (res) => {
    //   const url = res.url()
    //   if (url.match(/fetch_comment_count/)) {
    //     const response = await res.json()
    //     const comment =
    //       response.data.shortcode_media.edge_media_to_parent_comment
    //     if (comment.count) {
    //       for (const cmt of comment.edges) {
    //         const text = cmt.node.text
    //         const l = text
    //           .split('#')
    //           .filter(String)
    //           .map((x: any) => x.trim())
    //         if (l.length && l.length > 1) {
    //           hashtags = hashtags.concat(l)
    //           console.log(l)
    //         }
    //       }
    //     }
    //   }
    // })
    // await sleep(1000 * 60 * 10)
  } catch (e) {
    log(e)
  } finally {
    await terminate()
  }
}

main()
